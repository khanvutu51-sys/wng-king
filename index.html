<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultra Pro Analyzer v2</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{margin:0;font-family:Arial;background:linear-gradient(135deg,#141e30,#243b55);display:flex;justify-content:center;align-items:center;height:100vh;color:white;}
.container{width:460px;background:rgba(255,255,255,0.1);padding:20px;border-radius:15px;backdrop-filter:blur(15px);}
input,button{width:100%;padding:10px;margin-top:10px;border:none;border-radius:8px;font-size:14px;}
button{cursor:pointer;font-weight:bold;}
.primary{background:#00c6ff;color:white;}
.secondary{background:#444;color:white;}
.stat{display:grid;grid-template-columns:1fr 1fr;gap:5px;margin-top:10px;}
.stat div{background:white;color:black;padding:5px;border-radius:6px;text-align:center;}
#history div{margin:4px 0;padding:4px;border-radius:5px;text-align:center;}
.win{background:#38a169;}
.loss{background:#e53e3e;}
#rolling{font-size:22px;text-align:center;margin-top:10px;}
</style>
</head>
<body>
<div class="container">
<h3>Ultra Pro Analyzer v2</h3>

<input id="num" maxlength="1" placeholder="0-9">
<p id="rolling"></p>
<p id="timer"></p>

<div class="stat">
<div id="wC">Win: 0</div>
<div id="lC">Loss: 0</div>
</div>

<p id="streak"></p>
<div id="history"></div>
<div id="chartContainer">
<canvas id="chart"></canvas>
</div>

<hr>
<h4>Admin Settings</h4>
<label>Round Lock Time (sec)</label>
<input id="lockTime" type="number" value="10">

<label>Small Probability (%)</label>
<input id="prob" type="number" value="50">

<label>Auto Round Interval (sec)</label>
<input id="interval" type="number" value="5">

<button class="primary" onclick="saveAdmin()">Save Settings</button>
<button class="secondary" onclick="clearHistory()">Clear History</button>

</div>

<script>
let lock=false;
let timerInt,rollingInt;
let data=JSON.parse(localStorage.getItem("data"))||[];
let admin=JSON.parse(localStorage.getItem("admin"))||{lock:10,prob:50,interval:5};
lockTime.value=admin.lock;
prob.value=admin.prob;
interval.value=admin.interval;

const ctx=document.getElementById('chart').getContext('2d');
let chart=new Chart(ctx,{
type:'bar',
data:{labels:['Win','Loss'],datasets:[{label:'Count',data:[0,0],backgroundColor:['#38a169','#e53e3e']}]},
options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,precision:0}}}
});

function generateResult(){
if(lock) return;
let inputNum=Math.floor(Math.random()*10);
num.value=inputNum;

// Rolling animation
let rollCount=0;
rollingInt=setInterval(()=>{
rollCount++;
document.getElementById("rolling").innerText=Math.floor(Math.random()*10);
if(rollCount>=10){
clearInterval(rollingInt);
document.getElementById("rolling").innerText=inputNum;
finishRound(inputNum);
}
},50);

startLock();
}

function finishRound(inputNum){
let smallChance=admin.prob/100;
let result=Math.random()<smallChance?"Small":"Big";
let outcome=Math.random()<0.5?"Win":"Loss";
data.unshift(outcome);
localStorage.setItem("data",JSON.stringify(data));
render();
}

function startLock(){
lock=true;
let t=admin.lock;
document.querySelectorAll("button,input").forEach(e=>e.disabled=true);
timer.innerText="Wait: "+t+"s";

timerInt=setInterval(()=>{
t--;
timer.innerText="Wait: "+t+"s";
if(t<=0){
clearInterval(timerInt);
lock=false;
document.querySelectorAll("button,input").forEach(e=>e.disabled=false);
timer.innerText="";
setTimeout(runAutoRound, admin.interval*1000);
}
},1000);
}

function render(){
let w=data.filter(x=>x==="Win").length;
let l=data.length-w;
wC.innerText="Win: "+w;
lC.innerText="Loss: "+l;
history.innerHTML=data.map(x=>`<div class="${x==='Win'?'win':'loss'}">${x}</div>`).join("");
// streak
let streak=0,type="";
for(let i=0;i<data.length;i++){
if(i===0||data[i]===data[i-1]){type=data[i];streak++;}else break;}
streakText=streak?type+" streak: "+streak:"";
streak.innerText=streakText;
// chart update
chart.data.datasets[0].data=[w,l];
chart.update();
}

function saveAdmin(){
admin.lock=parseInt(lockTime.value)||10;
admin.prob=parseInt(prob.value)||50;
admin.interval=parseInt(interval.value)||5;
localStorage.setItem("admin",JSON.stringify(admin));
alert("Saved");
}

function clearHistory(){
if(confirm("Clear all history?")){
data=[];
localStorage.removeItem("data");
render();
}
}

function runAutoRound(){
generateResult();
}

render();
</script>
</body>
</html>
